# 圆桌射击游戏

### 问题：

圆桌上有1到1000号，1号右手边是2号，左手边是1000号。1号开枪打死2号，把枪交给3号，3号打死4号交给5号。如此继续下去，999号打死1000号后把枪交给1号，之后继续循环。请问最后留下来的是几号？

### 约瑟夫环：

实际上本题以及类似的题目都被称为约瑟夫环问题。这个问题是因一名犹太历史学家**弗拉维奥·约瑟夫**得名。他在自己的日记中写道，他和他的40个战友被罗马军队包围在洞中，讨论是自杀还是投降，最终决定自杀，并以抽签的方式决定谁杀掉谁。约瑟夫斯和另外一个人是最后两个留下的人。约瑟夫斯说服了那个人，他们将向罗马军队投降，不再自杀。

约瑟夫环有很多代码解法，但是本文只着重于讨论其数学解法。

### 分析：

1. 如果只剩下 2 个人，那么明显是拿枪的 1 号活到最后。
2. 如果剩下 4 个人，不难想象，第一圈会死掉一半的人，枪传了一圈之后还是会回到 1 号手中。所以回到了情况1。1 号活到最后。
3. 如果剩下 8 个人，死 4 个，枪在 1 号手中。回到情况 2。1 号活到最后。
4. 以此类推，如果是 $$2^n​$$ 次方个人，那么每一轮都会死一半的人，而枪会回到 1 号的手中。如此轮回，最终 1 号活到最后。
5. 也就是说，还剩 $$2^n$$ 个人时，谁刚拿到枪谁就能够活到最后。
6. 如果没有刚好剩下 $$2^n$$ 个人呢？那么就算一下，再死多少个之后，能剩下 $$2^n$$ 个人。至于这道题，死掉 488 个人时，刚好剩下 512 = $$2^9$$ 个人。这个时候，拿到枪的是 $$488 \times 2 + 1= 977$$ 号，所以他可以活到最后。

### 公式：

设 $$f(x) = t$$ 表示有 $$x$$ 个人，从 1 开始编号，最后活着的是人编号为 $$t$$。

1. 显然  $$f(2) = 1$$ 。
2. 由于如果是偶数个人，那么从 1 号开始开枪，一轮下来，会死一半的人。同时，枪刚好会回到 1 手上。换句话说就是，如果 $$f(n) = 1$$，那么 $$f(2n)=1$$。
3. 所以显然， $$f(2^n) = f(2^{n-1})=…=f(2)=1$$。
4. 而对于 $$2^n+l \  (2^{n-1}<l<2^n)$$  ，杀死 $$l$$ 个人之后，能够回到上一个情况。杀死 $$l$$ 个人之后，枪会回到 $$2l + 1$$ 号的人的手里。此时剩下 $$2^n$$ 个人，那么这个人将活到最后。即 $$f(2^n+l) = 2l+1$$。
5. $$f(1000) = f(2^9 + 488) = 2 \times 488 + 1 = 977$$

### 拓展分析：

那么对于$$f(x)$$，我们如何快速求的对应的 $$t$$ 值呢？

1. 由之前的分析，我们得到  $$f(2^n+l) = 2l+1$$。
2. 即，将 $$x$$ 改写为 $$x=2^n+l$$，可以算出 $$f(x) = 2l + 1$$。
3. 如何改写 $$x$$ ？由于有 $$2^n$$，我们考虑二进制。显然可以假设 $$x=(1a_{n-1}a_{n-2}a_{n-3}...a_1)_2$$，一共 $$n$$ 位二进制数，显然 $$l=(a_{n-1}a_{n-2}a_{n-3}…a_1)_2$$。所以当我们把 $$x$$ 写成二进制的时候，我们自然而然的就得到了拆分。
4. 对于二进制数而言，二倍就是左移一位，所以结果其实很巧妙：$$f(x) = 2l+1 = (a_{n-1}a_{n-2}a_{n-3}…a_11)_2$$
5. 总结，对于 x，将 $$x$$ 改写为二进制，然后将二进制最高位移动到最低位，得到新的二进制数，即为 $$f(x)$$。